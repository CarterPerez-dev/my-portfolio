{
  "slug": "stripe-referral",
  "language": "hi",
  "title": "stripe-referral",
  "subtitle": "प्लगेबल पेआउट एडाप्टर के साथ फ्रेमवर्क-एग्नॉस्टिक रेफरल पैकेज",
  "description": "यह CertGames के लिए बनाया जब मुझे वास्तविक पेआउट ऑटोमेशन के साथ रेफरल ट्रैकिंग की जरूरत थी। कोई भी मौजूदा पैकेज नहीं मिला जो Django या किसी विशिष्ट पेमेंट प्रोवाइडर से बंधे बिना पूरे लाइफसाइकल को संभाल सके, इसलिए मैंने जो बनाया था उसे एक स्टैंडअलोन PyPI पैकेज में निकाला। SQLAlchemy आधारित, किसी भी Python वेब फ्रेमवर्क के साथ काम करता है, Stripe Connect, Wise, और मैनुअल बैंक ट्रांसफर के लिए एडाप्टर के साथ शिप होता है।",
  "technical_details": "एडाप्टर पैटर्न यहां कोर एब्स्ट्रैक्शन है। हर पेआउट प्रोवाइडर सिर्फ दो मेथड्स के साथ `PayoutAdapter` इम्प्लीमेंट करता है: `send_payout` और `validate_recipient`। Wise सपोर्ट जोड़ने का मतलब था एक क्लास लिखना जो उनके API को हिट करे, सर्विस लेयर में कोई बदलाव नहीं। एडाप्टर्स expected failures के लिए exceptions raise करने के बजाय TypedDict results रिटर्न करते हैं, इसलिए आपको हर जगह try/catch के बजाय `PayoutResult(success=False, error=\"...\")` मिलता है।\n\n```python\n# Stripe Connect adapter validates the account exists and can receive funds\naccount = stripe.Account.retrieve(account_id)\nif not account.payouts_enabled:\n    return RecipientValidation(valid=False, error=\"Payouts not enabled\")\n```\n\nरिपॉजिटरी लेयर SQLAlchemy क्वेरीज को बिजनेस लॉजिक से अलग रखती है। हर मॉडल को अपनी रिपॉजिटरी मिलती है जिसमें टाइप्ड मेथड्स होते हैं। `ReferralTrackingRepository.get_user_earnings()` SQLAlchemy के `case()` expressions के माध्यम से calculated total, pending, और paid amounts के साथ एक dict रिटर्न करता है। सर्विस लेयर repositories को कॉल करती है और कभी भी ORM को सीधे नहीं छूती, जिससे यूनिट टेस्टिंग बहुत आसान हो गई क्योंकि मैं repository boundary पर mock कर सकता हूं।\n\n```python\n# Service layer stays clean, repositories handle the query complexity\nearnings = tracking_repo.get_user_earnings(user_id)\nreturn UserEarnings(total=earnings[\"total\"], pending=earnings[\"pending\"], paid=earnings[\"paid\"])\n```\n\nरेफरल कोड जनरेशन `secrets.token_urlsafe` और SHA256 हैशिंग के combination का उपयोग करके `REF_A3F2B1_xK9mNp` जैसे कोड प्रोड्यूस करता है। जनरेटर एक collision check callback लेता है इसलिए अगर कोड पहले से मौजूद है तो यह automatically retry करता है। `CodeGenerationError` raise करने से पहले अधिकतम दस प्रयास। यह पैटर्न generation logic को यूनिट टेस्ट में असली database की जरूरत के बिना टेस्टेबल रखता है।\n\n```python\ndef generate_unique_code(user_id: str, program_key: str, check_collision_fn) -> str:\n    for _ in range(CODE_GENERATION_RETRY_ATTEMPTS):\n        code = _generate_code_string(user_id, program_key)\n        if not check_collision_fn(code):\n            return code\n    raise CodeGenerationError(\"Failed after max attempts\")\n```\n\nexception hierarchy काफी granular है। एक base `StripeReferralError` है जिससे सब कुछ inherit करता है, फिर हर failure mode के लिए specific errors: `CodeExpiredError`, `CodeMaxUsesReachedError`, `SelfReferralError`, `PayoutAlreadyExistsError`, और लगभग एक दर्जन अन्य। हर exception arbitrary context kwargs accept करता है जो string representation में format हो जाते हैं। debugging आसान हो जाती है जब आप `CodeExpiredError: Code 'REF_ABC' expired at 2025-01-15 (code=REF_ABC, expires_at=2025-01-15)` देख सकते हैं।\n\nPydantic schema layer पर सभी input validation handle करता है। Request models data के service layer में पहुंचने से पहले whitespace strip करते हैं और length limits enforce करते हैं। `CreateProgramRequest` schema validate करता है कि currency codes exactly 3 characters हैं और उन्हें automatically uppercase करता है। Services पहले से validated data receive करती हैं और TypedDict results return करती हैं, जिससे API boundaries clean रहती हैं। Alembic migrations package के साथ ship होते हैं इसलिए users अपने existing database में tables set up करने के लिए `alembic upgrade head` run कर सकते हैं।",
  "tech_stack": [
    "Python",
    "SQLAlchemy",
    "Stripe Connect",
    "Pydantic",
    "Alembic",
    "PostgreSQL"
  ],
  "github_url": "https://github.com/CarterPerez-dev/stripe-referral",
  "demo_url": null,
  "website_url": null,
  "docs_url": null,
  "blog_url": null,
  "pypi_url": "https://pypi.org/project/stripe-referral/",
  "npm_url": null,
  "ios_url": null,
  "android_url": null,
  "code_snippet": "class PayoutAdapter(ABC):\n    @abstractmethod\n    def send_payout(\n        self,\n        user_id: str,\n        amount: float,\n        currency: str,\n        recipient_data: dict[str, Any],\n    ) -> PayoutResult:\n        \"\"\"Process a payout to the user\"\"\"\n\n    @abstractmethod\n    def validate_recipient(\n        self,\n        recipient_data: dict[str, Any]\n    ) -> RecipientValidation:\n        \"\"\"Validate recipient data before attempting payout\"\"\"",
  "code_language": "python",
  "code_filename": "src/stripe_referral/adapters/base.py",
  "banner_url": null,
  "thumbnail_url": null,
  "screenshots": null,
  "stars_count": 3,
  "forks_count": null,
  "downloads_count": null,
  "users_count": null,
  "display_order": 0,
  "is_complete": true,
  "is_featured": false,
  "status": "active",
  "start_date": "2025-11-20",
  "end_date": null
}
